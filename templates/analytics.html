{% extends 'base.html' %}
{% block content %}
<div class="container-xl">
    <h2>Analytics</h2>
    <ul class="nav nav-tabs mb-4">
        <li class="nav-item">
            <a class="nav-link {{ 'active' if range == 30 }}" data-range="30" href="?range=30">Last 30 Days</a>
        </li>
        <li class="nav-item">
            <a class="nav-link {{ 'active' if range == 90 }}" data-range="90" href="?range=90">Last 90 Days</a>
        </li>
    </ul>
    {% if labels %}
        <div class="card p-4 mb-4">
            <canvas id="earningsChart"></canvas>
            <script id="chartLabels" type="application/json">{{ labels | tojson }}</script>
            <script id="chartValues" type="application/json">{{ values | tojson }}</script>
        </div>
        {% if top_tags %}
            <h4>Top Tags</h4>
            <div class="table-responsive">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Tag</th>
                            <th>Count</th>
                            <th>Revenue</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for tag in top_tags %}
                            <tr>
                                <td>{{ tag.tag }}</td>
                                <td>{{ tag.count }}</td>
                                <td>{{ tag.total }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <div class="text-center py-5">
                <i class="bi bi-bar-chart display-4 text-muted"></i>
                <p class="mt-3">No tag data available for this period.</p>
            </div>
        {% endif %}
    {% else %}
        <div class="text-center py-5">
            <i class="bi bi-bar-chart display-4 text-muted"></i>
            <p class="mt-3">No earnings data available. Sync orders to see analytics.</p>
            <form method="POST" action="{{ url_for('orders.sync') }}" class="d-inline">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <button type="submit" class="btn btn-primary rounded-pill sync-button">Sync Now</button>
            </form>
        </div>
    {% endif %}
</div>
{% endblock %}
{% block scripts %}
    <script src="{{ url_for('static', filename='js/analytics.js') }}"></script>
{% endblock %}